<!--
Copyright 2014 Open vStorage NV

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<section data-bind="with: vPool()">
    <ol class="breadcrumb">
        <li class="active" data-bind="text: name"></li>
    </ol>
    <div>
        <ul class="nav nav-tabs">
            <li class="active">
                <a href="#information" data-toggle="tab" >
                    <span class="fa" data-i18n="[html]ovs:icons.information"></span>
                    <span style="padding-left: 5px;" data-bind="text: name, visible: name() !== undefined"></span>
                </a>
            </li>
            <li class="actions">
                <span data-i18n="ovs:generic.actions"></span>:
                <button type="button" class="btn btn-mini btn-default"
                        id="buttonVpoolSync"
                        data-bind="click: function() { $root.sync(); },
                                   style: { color: '#428bca' },
                                   tooltip: 'ovs:vpools.detail.sync',
                                   enable: $root.shared.user.roles().contains('write')">
                    <span class="fa" data-i18n="[html]ovs:icons.sync"></span>
                </button>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="information" style="padding: 15px;">
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th data-i18n="ovs:vpools.statistics" colspan="2"></th>
                            <th data-i18n="ovs:vpools.backend" colspan="2"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="width: 15%;" data-i18n="ovs:generic.storeddata"></td>
                            <td style="width: 35%;"><span data-bind="text: storedData"></span></td>
                            <td style="width: 15%;" data-i18n="ovs:vpools.backendtype"></td>
                            <td style="width: 35%;">
                                <span data-bind="lazyloader: { item: backendType, loadedObservable: 'loaded', undefinedLoading: false }">
                                    <span data-part="lazy-entry" data-bind="translate: 'ovs:generic.backendtypes.' + item().code()"></span>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td data-i18n="ovs:generic.cache"></td>
                            <td><span data-bind="text: cacheRatio"></span></td>
                            <td data-i18n="ovs:vpools.backendconnection"></td>
                            <td><span data-bind="text: backendConnection() ? backendConnection() : '-'"></span></td>
                        </tr>
                        <tr>
                            <td data-i18n="ovs:generic.iops"></td>
                            <td><span data-bind="text: iops"></span></td>
                            <td data-i18n="ovs:vpools.backendlogin"></td>
                            <td><span data-bind="text: backendLogin() ? backendLogin() : '-'"></span></td>
                        </tr>
                        <tr>
                            <td data-i18n="ovs:generic.readspeed"></td>
                            <td><span data-bind="text: readSpeed"></span></td>
                            <td data-i18n="ovs:generic.readspeed"></td>
                            <td><span data-bind="text: backendReadSpeed"></span></td>
                        </tr>
                        <tr>
                            <td data-i18n="ovs:generic.writespeed"></td>
                            <td><span data-bind="text: writeSpeed"></span></td>
                            <td data-i18n="ovs:generic.writespeed"></td>
                            <td><span data-bind="text: backendWriteSpeed"></span></td>
                        </tr>
                        <tr>
                            <td data-i18n="ovs:generic.nrofvmachines"></td>
                            <td><span data-bind="text: vMachines().length"></span></td>
                            <td colspan="2">&nbsp;</td>
                        </tr>
                        <tr>
                            <td data-i18n="ovs:generic.nrofvdisks"></td>
                            <td><span data-bind="text: vDisks().length"></span></td>
                            <td colspan="2">&nbsp;</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div>
        <ul class="nav nav-tabs">
            <li class="active" data-bind="tooltip: 'ovs:generic.vmachines'">
                <a href="#vmachines" data-toggle="tab" class="fa" data-i18n="[html]ovs:icons.vmachines"></a>
            </li>
            <li data-bind="tooltip: 'ovs:generic.vdisks'">
                <a href="#vdisks" data-toggle="tab" class="fa" data-i18n="[html]ovs:icons.vdisks"></a>
            </li>
            <li data-bind="tooltip: 'ovs:generic.management', visible: $root.shared.user.roles().contains('manage')">
                <a href="#management" data-toggle="tab" class="fa" data-i18n="[html]ovs:icons.management"></a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="vmachines" style="padding: 15px;">
                <h4 data-i18n="ovs:vmachines.title"></h4>
                <div data-bind="pager: { loadData: $parent.loadVMachines, headers: $parent.vMachineHeaders, refreshInterval: 5000, controls: true }">
                    <table data-dummy="dummy">
                        <tr data-part="vitem" data-bind="attr: { id: 'vmachine_' + guid() }">
                            <td style="position: relative;">
                                <span data-bind="visible: loading()" style="position: absolute; top: 7px; left: -15px;">
                                   <i class="fa fa-spin" data-i18n="[html]ovs:icons.loading"></i>
                                </span>
                                <a data-bind="html: loaded() ? (name() ? name() : '<i>name not set</i>') : '',
                                              attr: { href: $root.shared.routing.loadHash('vmachine-detail', { guid: guid }) }"></a>
                            </td>
                            <td data-bind="lazylist: { items: storageRouters, loadedObservable: 'loaded' }">
                                <a data-part="entry"
                                   data-bind="text: name,
                                              attr: { href: $root.shared.routing.loadHash('storagerouter-detail', { guid: guid }) }"></a>
                            </td>
                            <td><span data-bind="text: vDisks().length"></span></td>
                            <td><span data-bind="text: storedData"></span></td>
                            <td><span data-bind="text: cacheRatio"></span></td>
                            <td><span data-bind="text: iops"></span></td>
                            <td><span data-bind="text: readSpeed"></span></td>
                            <td><span data-bind="text: writeSpeed"></span></td>
                            <td>
                                <div data-bind="status: {
                                                    colors: {
                                                        green: ['ok_standalone', 'ok_sync'].contains(failoverMode()),
                                                        orange: failoverMode() == 'catch_up',
                                                        red: failoverMode() == 'degraded'
                                                    },
                                                    defaultColor: 'lightgrey'
                                                }, tooltip: 'ovs:generic.states.foc.' + failoverMode()"
                                     style="width: 14px; height: 14px;"></div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="vdisks" style="padding: 15px;">
                <h4 data-i18n="ovs:vdisks.title"></h4>
                <div data-bind="pager: { loadData: $parent.loadVDisks, headers: $parent.vDiskHeaders, refreshInterval: 5000, controls: true }">
                    <table data-dummy="dummy">
                        <tr data-part="vitem" data-bind="attr: { id: 'vdisk_' + guid() }">
                            <td style="position: relative;">
                                <span data-bind="visible: loading()" style="position: absolute; top: 7px; left: -15px;">
                                   <i class="fa fa-spin" data-i18n="[html]ovs:icons.loading"></i>
                                </span>
                                <a data-bind="html: loaded() ? (name() ? name() : '<i>name not set</i>') : '',
                                              attr: { href: $root.shared.routing.loadHash('vdisk-detail', { guid: guid }) }"></a>
                            </td>
                            <td>
                                <span data-bind="lazyloader: { item: vMachine, loadedObservable: 'loaded', undefinedLoading: false }">
                                    <a data-part="lazy-entry"
                                       data-bind="text: item().name,
                                                  attr: { href: $root.shared.routing.loadHash('vmachine-detail', { guid: item().guid }) }"></a>
                                </span>
                            </td>
                            <td><span data-bind="text: size"></span></td>
                            <td><span data-bind="text: storedData"></span></td>
                            <td><span data-bind="text: cacheRatio"></span></td>
                            <td><span data-bind="text: iops"></span></td>
                            <td><span data-bind="text: readSpeed"></span></td>
                            <td><span data-bind="text: writeSpeed"></span></td>
                            <td>
                                <div data-bind="status: {
                                                    colors: {
                                                        green: ['ok_standalone', 'ok_sync'].contains(failoverMode()),
                                                        orange: failoverMode() == 'catch_up',
                                                        red: failoverMode() == 'degraded'
                                                    },
                                                    defaultColor: 'lightgrey'
                                                }, tooltip: 'ovs:generic.states.foc.' + failoverMode()"
                                     style="width: 14px; height: 14px;"></div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="management" style="padding: 15px;" data-bind="visible: $root.shared.user.roles().contains('manage')">
                <table class="table table-noborder" style="width: 100%;">
                    <tbody>
                        <tr>
                             <td style="width: 90px; vertical-align: middle; padding: 0 0 20px 0;">
                                <button id="btn.vpool.management" type="button" class="btn btn-lg" data-bind="enable: false">
                                    <span class="fa fa-1p5x" data-i18n="[html]ovs:icons.storageroutervpoollink"></span>
                                </button>
                            </td>
                            <td style="padding: 0 0 20px 0;">
                                <h4 data-i18n="ovs:vpools.detail.storageroutervpoollink"></h4>
                                <table class="table table-noborder table-hover table-condensed">
                                    <thead>
                                        <tr>
                                            <th><span data-i18n="ovs:generic.storagerouter"></span></th>
                                            <th style="width: 125px;"><span data-i18n="ovs:generic.actions"></span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- ko foreach: $root.storageRouters() -->
                                            <tr>
                                                <td><span data-bind="text: name"></span></td>
                                                <!-- ko if: !$root.checkedStorageRouterGuids().contains(guid()) -->
                                                <td>
                                                    <button type="button"
                                                            class="btn btn-mini btn-default"
                                                            data-bind="click: $root.addStorageRouter,
                                                                       attr: { id: 'button_add_' + guid()},
                                                                       visible: $root.updatingStorageRouters() === false ">
                                                        <span class="fa" data-i18n="[html]ovs:icons.add"></span>
                                                    </button>
                                                </td>
                                                <!-- /ko -->
                                                <!-- ko if: $root.checkedStorageRouterGuids().contains(guid()) -->
                                                <td>
                                                    <button type="button"
                                                            class="btn btn-mini btn-default"
                                                            data-bind="click: $root.removeStorageRouter,
                                                                       attr: { id: 'button_remove_' + guid()},
                                                                       visible: $root.updatingStorageRouters() === false ">
                                                        <span class="fa" data-i18n="[html]ovs:icons.delete"></span>
                                                    </button>
                                                    <span class="fa-stack">
                                                        <i data-bind="click: function() { $root.reconfigurePmachine(guid(), true); },
                                                                      tooltip: 'ovs:wizards.linkhosts.gather.configure',
                                                                      visible: $root.updatingStorageRouters() === false &&
                                                                               pMachine() !== undefined &&
                                                                               !(pMachine().mgmtCenterGuid() === undefined || pMachine().mgmtCenterGuid() === null)"
                                                           class="hand fa fa-fw fa-stack-1x" data-i18n="[html]ovs:icons.cog">
                                                        </i>
                                                        <i data-bind="click: function() { $root.reconfigurePmachine(guid(), false); },
                                                                      tooltip: 'ovs:wizards.linkhosts.gather.unconfigure',
                                                                      style: { color: 'red' },
                                                                      visible: $root.updatingStorageRouters() === false &&
                                                                               pMachine() !== undefined &&
                                                                               !(pMachine().mgmtCenterGuid() === undefined || pMachine().mgmtCenterGuid() === null) &&
                                                                               pMachine().isVPoolConfigured()[$root.vPool().guid()]"
                                                           class="hand fa fa-fw fa-stack-1px6" data-i18n="[html]ovs:icons.ban">
                                                        </i>
                                                    </span>
                                                </td>
                                                <!-- /ko -->
                                            </tr>
                                        <!-- /ko -->
                                    </tbody>
                                </table>
                                <div data-bind="visible: backendType() === 'local'" class="alert alert-warning"
                                     data-i18n="ovs:vpools.detail.localvpool" style="margin-top: 10px;"></div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 90px; padding: 10px 0 20px 0;">
                                <button type="button" class="btn btn-lg" data-bind="enable: false">
                                    <span class="fa fa-1p5x" data-i18n="[html]ovs:icons.configuration"></span>
                                </button>
                            </td>
                            <td style="padding: 0 0 20px 0;">
                                <h4 data-i18n="ovs:vpools.detail.configuration"></h4>
                                <p data-i18n="ovs:vpools.detail.configurationinfo"></p>
                                <ul>
                                    <li>
                                        <span data-i18n="ovs:storagerouters.configuration.general.dtl"></span>
                                        <a data-bind="popover: {
                                                          title: 'ovs:storagerouters.configuration.general.dtl_help_title',
                                                          content: 'ovs:storagerouters.configuration.general.dtl_help_message'
                                                      }"
                                           class="hand fa noline"
                                           data-i18n="[html]ovs:icons.question_circle"
                                           style="margin-left: 5px; color: blue;"
                                           role="button"
                                           tabindex="-1">
                                        </a>
                                        <div>
                                            <table class="table table-condensed" style="margin-left: 20px; margin-bottom: 0; width: 100%;">
                                                <tbody>
                                                    <tr>
                                                        <td style="width: 20%; padding: 0;">
                                                            <div style="margin-top: 5px;">
                                                                <span data-i18n="ovs:storagerouters.configuration.general.dtl_enable"></span>:
                                                            </div>
                                                        </td>
                                                        <td style="padding: 0;">
                                                            <span data-bind="dropdown: {
                                                                                 items: dtlOptions,
                                                                                 target: dtlEnable,
                                                                                 text: function(item) {
                                                                                     if (item === undefined) {
                                                                                         return '-';
                                                                                     }
                                                                                     return $.t('ovs:storagerouters.configuration.general.dtl_options.' + item.value);
                                                                                 },
                                                                                 key: 'value',
                                                                                 keyisfunction: false,
                                                                                 small: true
                                                                             }">
                                                            </span>
                                                        </td>
                                                        <!--<td style="width: 20%; padding: 0;">-->
                                                            <!--<div style="margin-top: 5px;">-->
                                                                <!--<span data-i18n="ovs:storagerouters.configuration.general.dtl_mode"></span>:-->
                                                            <!--</div>-->
                                                        <!--</td>-->
                                                        <!--<td style="padding: 0;">-->
                                                            <!--<span data-bind="dropdown: {-->
                                                                                 <!--items: dtlModes,-->
                                                                                 <!--target: dtlMode,-->
                                                                                 <!--text: function(item) {-->
                                                                                     <!--if (item === undefined) {-->
                                                                                         <!--return '-';-->
                                                                                     <!--}-->
                                                                                     <!--return $.t('ovs:storagerouters.configuration.general.dtl_modes.' + item.name);-->
                                                                                 <!--},-->
                                                                                 <!--key: 'name',-->
                                                                                 <!--keyisfunction: false,-->
                                                                                 <!--small: true-->
                                                                             <!--}">-->
                                                            <!--</span>-->
                                                        <!--</td>-->
                                                    <!--</tr>-->
                                                    <!--<tr>-->
                                                        <!--<td style="width: 20%; padding: 0;">-->
                                                            <!--<div style="margin-top: 5px;">-->
                                                                <!--<span data-i18n="ovs:storagerouters.configuration.general.dtl_location"></span>:-->
                                                            <!--</div>-->
                                                        <!--</td>-->
                                                        <!--<td style="padding: 0;">-->
                                                            <!--<span data-bind="dropdown: {-->
                                                                                 <!--items: $parent.storageRouters,-->
                                                                                 <!--target: $parent.dtlLocation,-->
                                                                                 <!--text: function(item) {-->
                                                                                     <!--return item.name;-->
                                                                                 <!--},-->
                                                                                 <!--small: true-->
                                                                             <!--}">-->
                                                            <!--</span>-->
                                                        <!--</td>-->
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </li>
                                    <li>
                                        <span data-i18n="ovs:storagerouters.configuration.general.caching"></span>
                                        <div>
                                            <table class="table table-condensed" style="margin-left: 20px; margin-bottom: 0; width: 100%;">
                                                <tbody>
                                                    <tr>
                                                        <td style="width: 20%; padding: 0;">
                                                            <div style="margin-top: 5px;">
                                                                <span data-i18n="ovs:storagerouters.configuration.general.strategy"></span>:
                                                            </div>
                                                        </td>
                                                        <td style="padding: 0;">
                                                            <span data-bind="dropdown: {
                                                                                 items: cacheStrategies,
                                                                                 target: configCacheStrategy,
                                                                                 text: function(item) {
                                                                                     if (item === undefined) {
                                                                                         return '-';
                                                                                     }
                                                                                     return $.t('ovs:storagerouters.configuration.general.cache_strategies.' + item.name);
                                                                                 },
                                                                                 key: 'name',
                                                                                 keyisfunction: false,
                                                                                 small: true
                                                                             }">
                                                            </span>
                                                        </td>
                                                    </tr>
                                                    <tr >
                                                        <td style="width: 20%; padding: 0;">
                                                            <div style="margin-top: 5px;">
                                                                <span data-i18n="ovs:storagerouters.configuration.general.dedupe"></span>:
                                                                <a data-bind="popover: {
                                                                                  title: 'ovs:storagerouters.configuration.general.dedupe_help_title',
                                                                                  content: 'ovs:storagerouters.configuration.general.dedupe_help_message'
                                                                              }"
                                                                   class="hand fa noline"
                                                                   data-i18n="[html]ovs:icons.question_circle"
                                                                   style="margin-left: 5px; color: blue;"
                                                                   role="button"
                                                                   tabindex="-1">
                                                                </a>
                                                                <span class="help-block"
                                                                      data-i18n="ovs:storagerouters.configuration.general.dedupe_warning"
                                                                      style="font-size: smaller; margin-top: -4px">
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td style="padding: 0;">
                                                            <span data-bind="dropdown: {
                                                                                 items: dedupeModes,
                                                                                 target: dedupeMode,
                                                                                 text: function(item) {
                                                                                     if (item === undefined) {
                                                                                         return '-';
                                                                                     }
                                                                                     return $.t('ovs:storagerouters.configuration.general.dedupe_modes.' + item.name);
                                                                                 },
                                                                                 key: 'name',
                                                                                 keyisfunction: false,
                                                                                 small: true
                                                                             }">
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </li>
                                    <li>
                                        <span data-i18n="ovs:storagerouters.configuration.general.volume"></span>
                                        <div>
                                            <table class="table table-condensed" style="margin-left: 20px; margin-bottom: 0; width: 100%;">
                                                <tbody>
                                                    <tr>
                                                        <td style="width: 20%; padding: 0;">
                                                            <div style="margin-top: 5px;">
                                                                <span data-i18n="ovs:storagerouters.configuration.general.sco_size"></span>:
                                                            </div>
                                                        </td>
                                                        <td style="padding: 0;">
                                                            <span data-bind="dropdown: {
                                                                                 items: scoSizes,
                                                                                 target: scoSize,
                                                                                 text: function(item) {
                                                                                     if (item === undefined || item === null) {
                                                                                         return '-';
                                                                                     }
                                                                                     return item + ' ' + $.t('ovs:generic.m') + $.t('ovs:generic.b');
                                                                                 },
                                                                                 small: true
                                                                             }">
                                                            </span>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="width: 20%; padding: 0;">
                                                            <div style="margin-top: 5px;">
                                                                <span data-i18n="ovs:storagerouters.configuration.general.write_buffer"></span>:
                                                            </div>
                                                        </td>
                                                        <td style="padding: 0;">
                                                            <input data-bind="value: writeBuffer, valueUpdate: 'afterkeydown'"
                                                                   size="5"
                                                                   style="height: 25px; text-align: center;"/>
                                                            <span data-bind="text: ' GB'"></span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </li>
                                </ul>
                                <button data-bind="click: function() { $root.saveConfiguration() }, enable: configChanged()" class="btn btn-default" data-i18n="ovs:generic.save"></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>
