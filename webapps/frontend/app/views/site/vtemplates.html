<!--
Copyright (C) 2016 iNuron NV

This file is part of Open vStorage Open Source Edition (OSE),
as available from

      http://www.openvstorage.org and
      http://www.openvstorage.com.

This file is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License v3 (GNU AGPLv3)
as published by the Free Software Foundation, in version 3 as it comes
in the LICENSE.txt file of the Open vStorage OSE distribution.

Open vStorage is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY of any kind.
-->
<section>
    <h2 data-i18n="ovs:vtemplates.vmachines.title"></h2>
    <div data-bind="pager: { container: vMachineTemplates, loadData: loadVMachineTemplates, headers: vMachineTemplateHeaders, refreshInterval: 5000, controls: true }">
        <table data-dummy="dummy">
            <tr data-part="vitem">
                <td style="position: relative;">
                    <span data-bind="visible: loading()" style="position: absolute; top: 7px; left: -15px;">
                       <i class="fa fa-spin" data-i18n="[html]ovs:icons.loading"></i>
                    </span>
                    <span data-bind="text: name"></span>
                </td>
                <td><span data-bind="text: vDisks().length"></span></td>
                <td><span data-bind="text: templateChildrenGuids().length"></span></td>
                <td>
                    <i data-bind="attr: { id: 'vm-template-delete-' + guid() },
                                  click: function() {
                                      if ($.inArray('write', $root.shared.user.roles()) !== -1) {
                                          $root.deleteVMT($data.guid());
                                      }
                                  },
                                  style: { color: $.inArray('write', $root.shared.user.roles()) !== -1 && templateChildrenGuids().length === 0 ? 'black' : 'lightgrey' },
                                  tooltip: templateChildrenGuids().length > 0 ? 'ovs:generic.templatehaschildren' : ''"
                       class="hand fa fa-fw" data-i18n="[html]ovs:icons.delete"></i>
                    <i data-bind="attr: { id: 'vm-template-create-' + guid() },
                                  click: function() {
                                      if ($.inArray('write', $root.shared.user.roles()) !== -1) {
                                          $root.createFromVMT($data.guid());
                                      }
                                  },
                                  tooltip: 'ovs:generic.clone',
                                  style: { color: $.inArray('write', $root.shared.user.roles()) !== -1 ? 'black' : 'lightgrey' }"
                       class="hand fa fa-fw" data-i18n="[html]ovs:icons.fromtemplate"></i>
                </td>
            </tr>
        </table>
    </div>
    <h2 data-i18n="ovs:vtemplates.vdisks.title"></h2>
    <div data-bind="pager: { container: vDiskTemplates, loadData: loadVDiskTemplates, headers: vDiskTemplateHeaders, refreshInterval: 5000, controls: true }">
        <table data-dummy="dummy">
            <tr data-part="vitem">
                <td style="position: relative;">
                    <span data-bind="visible: loading()" style="position: absolute; top: 7px; left: -15px;">
                       <i class="fa fa-spin" data-i18n="[html]ovs:icons.loading"></i>
                    </span>
                    <span data-bind="text: name"></span>
                </td>
                <td>
                    <span data-bind="lazyloader: { item: vMachine, loadedObservable: 'loaded', undefinedLoading: false }">
                        <span data-part="lazy-entry">
                            <span data-bind="visible: item().isVTemplate()">
                                <span data-bind="text: item().name"></span>
                                &nbsp; <span class="fa" style="color: lightgrey;" data-bind="tooltip: 'ovs:generic.vtemplate'" data-i18n="[html]ovs:icons.set_as_template"></span>
                            </span>
                            <a data-bind="text: item().name, visible: !item().isVTemplate(),
                                          attr: { href: $root.shared.routing.loadHash('vmachine-detail', { guid: item().guid }) }"></a>
                        </span>
                    </span>
                </td>
                <td><span data-bind="text: templateChildrenGuids().length"></span></td>
                <td>
                    <i data-bind="attr: { id: 'vd-template-delete' + guid() },
                                  click: function() {
                                      if ($.inArray('write', $root.shared.user.roles()) !== -1) {
                                          $root.deleteVDT($data.guid());
                                      }
                                  },
                                  style: { color: $.inArray('write', $root.shared.user.roles()) !== -1 && templateChildrenGuids().length === 0 ? 'black' : 'lightgrey' },
                                  tooltip: templateChildrenGuids().length > 0 ? 'ovs:generic.templatehaschildren' : ''"
                       class="hand fa fa-fw" data-i18n="[html]ovs:icons.delete"></i>
                    <i data-bind="attr: { id: 'vd-template-create-' + guid() },
                                  click: function() {
                                      if ($.inArray('write', $root.shared.user.roles()) !== -1) {
                                          $root.createFromVDT($data.guid());
                                      }
                                  },
                                  tooltip: 'ovs:generic.clone',
                                  style: { color: $.inArray('write', $root.shared.user.roles()) !== -1 ? 'black' : 'lightgrey' }"
                       class="hand fa fa-fw" data-i18n="[html]ovs:icons.fromtemplate"></i>
                </td>
            </tr>
        </table>
    </div>
</section>
